@{
    ViewBag.Title = "Ventas";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>


<ol class="breadcrumb mb-4 mt-4">
    <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Resumen</a></li>
    <li class="breadcrumb-item active">Registro de Venta</li>
</ol>

<div class="card">
    <div class="card-header">
        <i class="fas fa-cash-register"></i> Registro de Venta
    </div>
    <div class="card-body">
        <form id="formRegistroVenta">
            <input id="txtidTIENDA" type="hidden" value="1" />
            <input id="txtidUSUARIO" type="hidden" value="6" />

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Cliente</label>
                    <div class="input-group">
                        <input type="hidden" id="txtIdClienteSeleccionado" value="0" />
                        <input type="text" class="form-control" id="txtNombreClienteSeleccionado" placeholder="Seleccione un cliente" readonly />
                        <button type="button" class="btn btn-primary" id="btnAbrirModalClientes">
                            <i class="fas fa-search"></i> Buscar Cliente
                        </button>
                    </div>
                </div>
                <div class="col-sm-6">
                    <label class="form-label">Tipo de Pago</label>
                    <select id="cboTP" class="form-select">
                    </select>
                </div>
            </div>
            <hr />
            <div class="row mb-3">
                <div class="col-sm-6">
                    <label class="form-label">Producto / Servicio</label>
                    <div class="input-group">
                        <input type="hidden" id="txtIdItemSeleccionado" value="0" />
                        <input type="hidden" id="txtTipoItemSeleccionado" value="" />
                        <input type="text" class="form-control" id="txtNombreItemSeleccionado" placeholder="Seleccione un producto o servicio" readonly />
                        <button type="button" class="btn btn-primary" id="btnAbrirModalItems">
                            <i class="fas fa-search"></i> Buscar Ítem
                        </button>
                    </div>
                </div>
                <div class="col-md-3">
                    <label for="txtCantidad" class="form-label">Cantidad</label>
                    <input type="number" class="form-control" id="txtCantidad" value="1" min="1" required>
                </div>
                <div class="col-md-3">
                    <label for="txtPrecioUnitario" class="form-label">Precio Unitario</label>
                    <div class="input-group">
                        <span class="input-group-text">Bs./</span>
                        <input type="text" class="form-control" id="txtPrecioUnitario" value="0.00" required>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <button type="button" class="btn btn-success" id="btnAgregarItem">Agregar a Venta</button>
                </div>
            </div>
        </form>

        <hr />

        <div class="row mt-4">
            <div class="col-12">
                <h4>Detalle de la Venta</h4>
                <table id="tablaDetalleVenta" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Ítem</th>
                            <th>Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Subtotal</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-8"></div>
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text">Total: Bs./</span>
                    <input type="text" class="form-control" id="txtTotalVenta" value="0.00" readonly>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-12">
                <div id="mensajeError" class="alert alert-danger" role="alert" style="display: none;">
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <button type="button" class="btn btn-primary" id="btnRegistrarVenta">Registrar Venta</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalBuscarCliente" tabindex="-1" aria-labelledby="modalBuscarClienteLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="modalBuscarClienteLabel">Buscar Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="txtBuscarClienteModal" placeholder="Escriba el nombre o apellido del cliente..." />
                    <button type="button" class="btn btn-outline-secondary" id="btnFiltrarClienteModal">
                        <i class="fas fa-filter"></i> Filtrar
                    </button>
                </div>
                <table id="tablaClientesModal" class="display cell-border" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombres</th>
                            <th>Apellidos</th>
                            <th>Teléfono</th>
                            <th>Correo</th>
                            <th>Estado</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalBuscarItem" tabindex="-1" aria-labelledby="modalBuscarItemLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="modalBuscarItemLabel">Buscar Producto o Servicio</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="txtBuscarItemModal" placeholder="Escriba el nombre del producto o servicio..." />
                    <button type="button" class="btn btn-outline-secondary" id="btnFiltrarItemModal">
                        <i class="fas fa-filter"></i> Filtrar
                    </button>
                </div>
                <table id="tablaItemsModal" class="display cell-border" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tipo</th>
                            <th>Nombre</th>
                            <th>Descripción</th>
                            <th>Precio</th>
                            <th>Estado</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var listaClientesGlobal = []; // Para almacenar los clientes
        var listaProductosGlobal = []; // Para almacenar los productos
        var listaServiciosGlobal = []; // Para almacenar los servicios
        var listaItemsGlobal = []; // Combinación de productos y servicios para el modal de ítems

        var tablaDetalleVenta; // DataTable del detalle de venta
        var tablaClientesModal; // DataTable del modal de clientes
        var tablaItemsModal; // DataTable del modal de productos/servicios

        // =======================================================================================
        // 1. INICIALIZACIÓN DE DATATABLES
        // =======================================================================================

        // Inicializar DataTable para el detalle de venta
        tablaDetalleVenta = $('#tablaDetalleVenta').DataTable({
            responsive: true,
            ordering: false,
            "columns": [
                { "data": "tipo_item" }, // Nueva columna para el tipo de ítem
                { "data": "nombreItem" },
                { "data": "cantidad" },
                {
                    "data": "precio",
                    "render": function (data) {
                        return 'Bs./ ' + parseFloat(data).toFixed(2);
                    }
                },
                {
                    "data": "sub_total",
                    "render": function (data) {
                        return 'Bs./ ' + parseFloat(data).toFixed(2);
                    }
                },
                {
                    "defaultContent": '<button type="button" class="btn btn-danger btn-sm btn-eliminar-detalle"><i class="fas fa-trash-alt"></i></button>',
                    "orderable": false,
                    "searchable": false,
                    "width": "80px"
                }
            ],
            "language": {
                "url": '//cdn.datatables.net/plug-ins/2.2.1/i18n/es-ES.json',
            },
            "paging": false, // No paginación para el detalle de venta
            "info": false,   // No información de filas para el detalle de venta
            "searching": false // No búsqueda para el detalle de venta
        });

        // =======================================================================================
        // 2. CARGA INICIAL DE DATOS (AJAX)
        // =======================================================================================

        // Cargar clientes en una variable global y en el DataTable del modal de clientes
        jQuery.ajax({
            url: '@Url.Action("ListarClientes", "Operaciones")',
            type: 'GET',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                listaClientesGlobal = data.data; // Almacenar todos los clientes

                tablaClientesModal = $('#tablaClientesModal').DataTable({
                    data: listaClientesGlobal,
                    responsive: true,
                    ordering: false,
                    "columns": [
                        { "data": "id_cliente" },
                        { "data": "nombres" },
                        { "data": "apellidos" },
                        { "data": "telefono" },
                        { "data": "correo" },
                        {
                            "data": "estado",
                            "render": function (valor) {
                                return valor ? '<span class="badge bg-success">Activo</span>' : '<span class="badge bg-danger">Inactivo</span>';
                            }
                        },
                        {
                            "defaultContent": '<button type="button" class="btn btn-success btn-sm btn-seleccionar-cliente"><i class="fas fa-check"></i> Seleccionar</button>',
                            "orderable": false,
                            "searchable": false,
                            "width": "100px"
                        }
                    ],
                    "language": {
                        "url": '//cdn.datatables.net/plug-ins/2.2.1/i18n/es-ES.json',
                    },
                    "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "Todos"]]
                });
            },
            error: function (error) {
                console.log("Error al cargar clientes:", error);
            }
        });

        // Cargar productos y servicios y combinarlos para el modal de ítems
        // Se usan $.when para esperar que ambas llamadas AJAX se completen
        $.when(
            jQuery.ajax({
                url: '@Url.Action("ListarProductos", "Mantenedor")',
                type: 'GET',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8'
            }),
            jQuery.ajax({
                url: '@Url.Action("ListarServicios", "Mantenedor")', // Asumiendo que tienes un ListarServicios en MantenedorController
                type: 'GET',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8'
            })
        ).done(function (productosResponse, serviciosResponse) {
            listaProductosGlobal = productosResponse[0].data;
            listaServiciosGlobal = serviciosResponse[0].data;

            // Combinar productos y servicios en una sola lista, añadiendo el tipo de ítem
            listaItemsGlobal = [];
            $.each(listaProductosGlobal, function (index, p) {
                listaItemsGlobal.push({
                    id: p.id_producto,
                    tipo_item: 'PRODUCTO',
                    nombre: p.nombre,
                    descripcion: p.descripcion,
                    precio: p.precio,
                    estado: p.estado,
                    oUnidadMedida: p.oUnidadMedida // Mantener si es relevante para mostrar
                });
            });
            $.each(listaServiciosGlobal, function (index, s) {
                listaItemsGlobal.push({
                    id: s.id_servicio,
                    tipo_item: 'SERVICIO',
                    nombre: s.nombre,
                    descripcion: s.descripcion,
                    precio: s.precio,
                    estado: s.estado
                    // Los servicios no tienen unidad de medida ni imágenes en tu esquema actual
                });
            });

            // Inicializar DataTable del modal de productos/servicios
            tablaItemsModal = $('#tablaItemsModal').DataTable({
                data: listaItemsGlobal,
                responsive: true,
                ordering: false,
                "columns": [
                    { "data": "id" },
                    { "data": "tipo_item" },
                    { "data": "nombre" },
                    { "data": "descripcion" },
                    {
                        "data": "precio",
                        "render": function (data) {
                            return 'Bs./ ' + parseFloat(data).toFixed(2);
                        }
                    },
                    {
                        "data": "estado",
                        "render": function (valor) {
                            return valor ? '<span class="badge bg-success">Activo</span>' : '<span class="badge bg-danger">Inactivo</span>';
                        }
                    },
                    {
                        "defaultContent": '<button type="button" class="btn btn-success btn-sm btn-seleccionar-item"><i class="fas fa-check"></i> Seleccionar</button>',
                        "orderable": false,
                        "searchable": false,
                        "width": "100px"
                    }
                ],
                "language": {
                    "url": '//cdn.datatables.net/plug-ins/2.2.1/i18n/es-ES.json',
                },
                "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "Todos"]]
            });
        }).fail(function (error) {
            console.log("Error al cargar productos o servicios:", error);
        });


        // Cargar tipos de pago en el ComboBox
        jQuery.ajax({
            url: '@Url.Action("ListarTP", "Mantenedor")',
            type: 'GET',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data.data, function (index, valor) {
                    $("<option>").attr("value", valor.id_tipo_pago).text(valor.descripcion).appendTo("#cboTP");
                });
            },
            error: function (error) {
                console.log("Error al cargar tipos de pago:", error);
            }
        });

        // =======================================================================================
        // 3. FUNCIONES DE UTILIDAD
        // =======================================================================================

        // Función para mostrar mensajes de error en el div #mensajeError
        function mostrarMensajeError(mensaje) {
            $("#mensajeError").text(mensaje);
            $("#mensajeError").show();
        }

        // Función para ocultar mensajes de error
        function ocultarMensajeError() {
            $("#mensajeError").hide();
        }

        // Función para calcular el total de la venta
        function calcularTotalVenta() {
            let total = 0;
            tablaDetalleVenta.rows().every(function () {
                let data = this.data();
                total += parseFloat(data.sub_total);
            });
            $("#txtTotalVenta").val(total.toFixed(2));
        }

        // Función para limpiar el formulario después de registrar una venta
        function limpiarFormularioVenta() {
            $("#txtIdClienteSeleccionado").val("0");
            $("#txtNombreClienteSeleccionado").val("");
            //$("#cboTP").val("");
            $("#txtIdItemSeleccionado").val("0");
            $("#txtTipoItemSeleccionado").val("");
            $("#txtNombreItemSeleccionado").val("");
            $("#txtCantidad").val("1");
            $("#txtPrecioUnitario").val("0.00");
            tablaDetalleVenta.clear().draw(); // Limpiar la tabla de detalles
            calcularTotalVenta(); // Resetear el total a 0.00
            ocultarMensajeError();
        }

        // =======================================================================================
        // 4. LÓGICA DE MODALES Y SELECCIÓN
        // =======================================================================================

        // --- Lógica para el Modal de Clientes ---
        $("#btnAbrirModalClientes").on("click", function () {
            $("#txtBuscarClienteModal").val("");
            tablaClientesModal.search('').columns().search('').draw(); // Limpiar búsqueda y filtro
            $('#modalBuscarCliente').modal('show');
        });

        $("#txtBuscarClienteModal").on("keyup", function () {
            tablaClientesModal.search($(this).val()).draw();
        });

        $("#btnFiltrarClienteModal").on("click", function () {
            tablaClientesModal.search($("#txtBuscarClienteModal").val()).draw();
        });

        $('#tablaClientesModal tbody').on('click', '.btn-seleccionar-cliente', function () {
            let data = tablaClientesModal.row($(this).parents('tr')).data();

            $("#txtIdClienteSeleccionado").val(data.id_cliente);
            $("#txtNombreClienteSeleccionado").val(data.nombres + " " + (data.apellidos || "")); // Concatenar nombre y apellido

            $('#modalBuscarCliente').modal('hide');
        });

        // --- Lógica para el Modal de Productos/Servicios (Ítems) ---
        $("#btnAbrirModalItems").on("click", function () {
            $("#txtBuscarItemModal").val("");
            tablaItemsModal.search('').columns().search('').draw();
            $('#modalBuscarItem').modal('show');
        });

        $("#txtBuscarItemModal").on("keyup", function () {
            tablaItemsModal.search($(this).val()).draw();
        });

        $("#btnFiltrarItemModal").on("click", function () {
            tablaItemsModal.search($("#txtBuscarItemModal").val()).draw();
        });

        $('#tablaItemsModal tbody').on('click', '.btn-seleccionar-item', function () {
            let data = tablaItemsModal.row($(this).parents('tr')).data();

            $("#txtIdItemSeleccionado").val(data.id);
            $("#txtTipoItemSeleccionado").val(data.tipo_item);
            $("#txtNombreItemSeleccionado").val(data.nombre);
            $("#txtPrecioUnitario").val(parseFloat(data.precio).toFixed(2));
            $("#txtCantidad").val("1");

            $('#modalBuscarItem').modal('hide');
        });

        // =======================================================================================
        // 5. LÓGICA DE AGREGAR Y REGISTRAR VENTA
        // =======================================================================================

        // Evento click para el botón "Agregar a Venta"
        $("#btnAgregarItem").on("click", function () {
            ocultarMensajeError();

            let idItem = $("#txtIdItemSeleccionado").val();
            let tipoItem = $("#txtTipoItemSeleccionado").val();
            let nombreItem = $("#txtNombreItemSeleccionado").val();
            let cantidad = parseInt($("#txtCantidad").val());
            let precioUnitario = parseFloat($("#txtPrecioUnitario").val());

            // Validaciones
            if (idItem === "" || idItem === "0" || tipoItem === "") {
                mostrarMensajeError("Debe seleccionar un producto o servicio.");
                return;
            }
            if (isNaN(cantidad) || cantidad <= 0) {
                mostrarMensajeError("La cantidad debe ser un número mayor a cero.");
                return;
            }
            if (isNaN(precioUnitario) || precioUnitario <= 0) {
                mostrarMensajeError("El precio unitario debe ser un número mayor a cero.");
                return;
            }

            // Verificar si el ítem ya existe en la tabla de detalle para evitar duplicados
            let itemYaEnTabla = false;
            tablaDetalleVenta.rows().every(function () {
                let data = this.data();
                // Compara por ID y por TIPO de ítem
                if (data.id_item == idItem && data.tipo_item == tipoItem) {
                    itemYaEnTabla = true;
                    return false; // Salir del bucle early
                }
            });

            if (itemYaEnTabla) {
                mostrarMensajeError("El ítem (producto/servicio) ya ha sido agregado al detalle de la venta.");
                return;
            }

            let subTotal = cantidad * precioUnitario;

            // Crear el objeto para la fila del DataTable
            let fila = {
                id_item: idItem, // Usamos un ID genérico para el frontend
                tipo_item: tipoItem,
                nombreItem: nombreItem,
                cantidad: cantidad,
                precio: precioUnitario,
                sub_total: subTotal,
                PRODUCTO_id_producto: (tipoItem === 'PRODUCTO' ? parseInt(idItem) : null),
                SERVICIO_id_servicio: (tipoItem === 'SERVICIO' ? parseInt(idItem) : null)
            };

            // Añadir la fila a la tabla
            tablaDetalleVenta.row.add(fila).draw();

            // Recalcular el total de la venta
            calcularTotalVenta();

            // Limpiar campos del ítem para agregar el siguiente
            $("#txtIdItemSeleccionado").val("0");
            $("#txtTipoItemSeleccionado").val("");
            $("#txtNombreItemSeleccionado").val("");
            $("#txtCantidad").val("1");
            $("#txtPrecioUnitario").val("0.00");
        });

        // Evento click para eliminar un ítem del detalle
        $('#tablaDetalleVenta tbody').on('click', '.btn-eliminar-detalle', function () {
            tablaDetalleVenta.row($(this).parents('tr')).remove().draw();
            calcularTotalVenta(); // Recalcular total después de eliminar
        });

        // Evento click para el botón "Registrar Venta"
        $("#btnRegistrarVenta").on("click", function () {
            ocultarMensajeError();

            let idCliente = $("#txtIdClienteSeleccionado").val();
            let idTipoPago = $("#cboTP").val();
            let idUsuario = $("#txtidUSUARIO").val();
            let idTienda = $("#txtidTIENDA").val();
            let montoTotal = parseFloat($("#txtTotalVenta").val());

            // Validaciones de encabezado
            if (idCliente === "" || idCliente === "0") {
                mostrarMensajeError("Debe seleccionar un cliente.");
                return;
            }
            if (idTipoPago === "" || idTipoPago === "0") {
                mostrarMensajeError("Debe seleccionar un tipo de pago.");
                return;
            }
            if (tablaDetalleVenta.rows().count() === 0) {
                mostrarMensajeError("Debe agregar al menos un producto o servicio al detalle de la venta.");
                return;
            }
            if (isNaN(montoTotal) || montoTotal <= 0) {
                 mostrarMensajeError("El monto total de la venta debe ser mayor a cero.");
                 return;
            }

            // Construir el objeto Venta para enviar al controlador
            let oVenta = {
                CLIENTE_id_cliente: parseInt(idCliente),
                TIPO_PAGO_id_tipo_pago: parseInt(idTipoPago),
                USUARIO_id_usuario: parseInt(idUsuario),
                TIENDA_id_tienda: parseInt(idTienda),
                monto_total: montoTotal,
                oDetalleVenta: []
            };

            // Llenar los detalles de la venta desde el DataTable
            tablaDetalleVenta.rows().every(function () {
                let data = this.data();
                oVenta.oDetalleVenta.push({
                    PRODUCTO_id_producto: data.PRODUCTO_id_producto, // Será null si es servicio
                    SERVICIO_id_servicio: data.SERVICIO_id_servicio, // Será null si es producto
                    cantidad: parseInt(data.cantidad),
                    precio: parseFloat(data.precio),
                    sub_total: parseFloat(data.sub_total),
                    tipo_item: data.tipo_item
                });
            });

            // Llamada AJAX para registrar la venta
            jQuery.ajax({
                url: '@Url.Action("RegistrarVenta", "Operaciones")',
                type: 'POST',
                data: JSON.stringify({ objetoVenta: JSON.stringify(oVenta) }),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $(".card-body").LoadingOverlay("hide");

                    if (data.operacionExitosa) {
                        // Usar SweetAlert2 con botones personalizados para opciones de impresión
                        Swal.fire({
                            title: '¡Venta Registrada!',
                            text: 'La venta se ha registrado exitosamente. ¿Desea imprimir un comprobante?',
                            icon: 'success',
                            showDenyButton: true, // Mostrar botón "Imprimir Recibo"
                            showCancelButton: true, // Mostrar botón "Cerrar"
                            confirmButtonText: 'Imprimir Factura Formal',
                            denyButtonText: 'Imprimir Recibo Térmico',
                            cancelButtonText: 'Cerrar',
                            reverseButtons: true // Opcional: invierte el orden de los botones
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // El usuario hizo clic en "Imprimir Factura Formal"
                                window.open('@Url.Action("GenerarFacturaFormal", "Operaciones")?idVenta=' + data.idVenta, '_blank');
                            } else if (result.isDenied) {
                                // El usuario hizo clic en "Imprimir Recibo Térmico"
                                window.open('@Url.Action("GenerarReciboTermico", "Operaciones")?idVenta=' + data.idVenta, '_blank');
                            }
                            // Si result.isDismissed (cancelButton o clic fuera), no hace nada más que cerrar el modal
                            limpiarFormularioVenta(); // Limpiar el formulario después de la acción de SweetAlert2
                        });
                    } else {
                        // Mensaje de error si la operación no fue exitosa
                        Swal.fire({
                            title: 'Error al Registrar Venta',
                            text: data.mensaje,
                            icon: 'error',
                            confirmButtonText: 'Aceptar'
                        });
                        // No limpiar el formulario en caso de error para que el usuario pueda corregir
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(jqXHR.responseText);
                    $(".card-body").LoadingOverlay("hide");
                    Swal.fire({
                        title: 'Error de Conexión',
                        text: 'Error al registrar la venta: ' + textStatus + ' - ' + errorThrown,
                        icon: 'error',
                        confirmButtonText: 'Aceptar'
                    });
                },
                beforeSend: function () {
                    $(".card-body").LoadingOverlay("show", {
                        imageResizeFactor: 2,
                        text: "Registrando venta...",
                        size: 24
                    });
                }
            });
        });
    </script>
}
